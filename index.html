<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>学习笔记</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Description">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
  <link rel="icon" href="./9527.png">
</head>

<body>
  <div id="app"></div>
  <!-- 实现量子纠缠的 以下两个div-->
  <div id="center"></div>
    <div id="msg"></div>
  <script>
    window.$docsify = {
      // 文档标题，会显示在侧边栏顶部。
      name: '学习笔记',
      nameLink: '/',
      // 通过该变量显示文档更新日期 
      formatUpdated: '{MM}/{DD} {HH}:{mm}',
      externalLinkTarget: '_blank',
      //logo: 'https://cdn.jsdelivr.net/gh/arenxiaolanz/picodemo/img/faviconyellow.png',
      // 设置右上角的github跳转地址
      repo: 'https://github.com/zhujun-max/docsify_study',
      // 是否使用右上角的自定义导航栏，会加载 _navbar.md 文件
      loadNavbar: false,
      // 加载自定义侧边栏，会加载 _sidebar.md 文件
      loadSidebar: true,
      // 可以配置 alias 避免不必要的回退过程。
      alias: {
        '/.*/_sidebar.md': '/_sidebar.md'
      },
      // 配置最大支持渲染的标题层级1-6
      // maxLevel:1,
      // 自定义侧边栏后默认不会再生成目录0，可以设置数值开启
      subMaxLevel: 2,
      mergeNvabar: true,
      homepage: './home.md',
      // 是否开始封面页
      coverpage: true,
      // 完整配置参数
      search: {
        maxAge: 5000, // 过期时间，单位毫秒，默认一天
        placeholder: '搜索',
        noData: '找不到结果',
        // 搜索标题的最大层级, 1 - 6
        depth: 4,
        hideOtherSidebarContent: false, // 是否隐藏其他侧边栏内容
      },
      // 字数统计
      count: {
        countable: true,
        fontsize: '0.9em',
        color: 'rgb(90,90,90)',
        language: 'chinese'
      },
      // 切换页面后是否自动跳转到页面顶部。
      auto2top: true,
    }
  </script>
  <!-- Docsify v4 -->
  <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
  <!-- 解析表情符号 -->
  <!-- <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/emoji.min.js"></script> -->
  <!-- 字数统计 -->
  <script src="//unpkg.com/docsify-count/dist/countable.js"></script>
  <!-- 代码高亮 -->
  <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-php.min.js"></script>
  <!-- 全文搜索 -->
  <!-- <script src="//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js"></script> -->
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
  <!-- 复制代码 -->
  <script src="//cdn.jsdelivr.net/npm/docsify-copy-code/dist/docsify-copy-code.min.js"></script>
</body>
<style>
  .markdown-section pre>code {
    padding: 10px !important;
    margin-bottom: 0 !important;
  }
</style>




<!-- 实现量子纠缠 -->
<style>
  .arrow {
    width: 80vmin;
    height: 80vmin;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(0deg);
  }

  .arrow::after {
    content: "";
    display: block;
    width: 100vmax;
    height: 3px;
    background-color: red;
    position: absolute;
    top: 50%;
    right: 50%;
    transform: translateY(-50%);
  }

  .arrow img {
    width: 100%;
    height: 100%;
  }

  #center {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    z-index: 999;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  #msg {
    position: absolute;
    left: 1em;
    top: 1em;
    opacity: 0;
    visibility: hidden;
  }
</style>
<script>
  const otherWindows = new Map();
  const channel = new BroadcastChannel("tab_position_channel");
  const wId = Date.now() + "-" + Math.random();
  const color =
    "#" + Math.floor(Math.random() * parseInt("ffff", 16)).toString(16);
  let _new = true;
  const MSG_TYPE = {
    POSITION: 0,
    NEW: 1,
    REMOVE: 2,
    OTHER: 3,
  };
  const lastPosition = {
    x: 0,
    y: 0,
  };

  window.onunload = () => {
    channel.postMessage({
      type: MSG_TYPE.REMOVE,
      wId,
    });
  };

  channel.onmessage = ({ data: { type, x, y, wId: otherId } }) => {
    console.log(`type: ${type}, x: ${x}, y: ${y}, wId: ${wId}`);


    switch (type) {
      case MSG_TYPE.NEW:
        _AddWin({ otherId, x, y });

        channel.postMessage({
          type: MSG_TYPE.OTHER,
          x: lastPosition.x,
          y: lastPosition.y,
          wId,
        });

        break;
      case MSG_TYPE.POSITION:
        otherWindows.set(otherId, {
          x,
          y,
        });

        [...otherWindows.keys()].forEach((otherId) => {
          const arrow = document.getElementById(otherId);
          const { x, y } = otherWindows.get(otherId);
          arrow.style.transform = `translate(-50%, -50%) rotate(${
            (Math.atan2(lastPosition.y - y, lastPosition.x - x) * 180) /
            Math.PI
          }deg)`;
        });

        break;
      case MSG_TYPE.OTHER:
        if (!otherWindows.has(otherId)) {
          _AddWin({ otherId, x, y });
        }
        break;
      case MSG_TYPE.REMOVE:
        otherWindows.delete(otherId);
        document.getElementById(otherId)?.remove();
        break;
    }
  };

  function _AddWin({ otherId, x, y }) {
    otherWindows.set(otherId, {
      x,
      y,
    });

    const arrow = document.createElement("div");
    arrow.className = "arrow";
    arrow.id = otherId;
    arrow.style.transform = `translate(-50%, -50%) rotate(${
      (Math.atan2(lastPosition.y - y, lastPosition.x - x) * 180) / Math.PI
    }deg)`;
    arrow.innerHTML = `<img src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%221000%22%20height%3D%221000%22%3E%3Cpath%20fill%3D%22currentColor%22%20fill-opacity%3D%22.8%22%20d%3D%22M1005%20530.682H217.267v-61.364H1005v61.363z%22%2F%3E%3Cpath%20fill%3D%22currentColor%22%20fill-opacity%3D%22.8%22%20d%3D%22M217.989%20581.415%204%20503.552l213.989-79.967z%22%2F%3E%3C%2Fsvg%3E" />`;
    document.body.appendChild(arrow);
  }

  function render() {
    requestAnimationFrame(() => {
      const absoluteCenter = {
        x:
          window.screenX /* + (window.outerWidth - window.innerWidth)*/ +
          window.innerWidth / 2,
        y:
          window.screenY +
          (window.outerHeight - window.innerHeight) +
          window.innerHeight / 2,
      };

      if (
        absoluteCenter.x !== lastPosition.x ||
        absoluteCenter.y !== lastPosition.y
      ) {
        lastPosition.x = absoluteCenter.x;
        lastPosition.y = absoluteCenter.y;

        if (_new) {
          _new = false;
          channel.postMessage({
            type: MSG_TYPE.NEW,
            x: lastPosition.x,
            y: lastPosition.y,
            wId,
          });
        } else {
          channel.postMessage({
            type: MSG_TYPE.POSITION,
            x: absoluteCenter.x,
            y: absoluteCenter.y,
            wId,
          });
        }

        otherWindows.forEach(({ x, y }, otherId) => {
          const angle =
            (Math.atan2(lastPosition.y - y, lastPosition.x - x) * 180) /
            Math.PI;
          document.getElementById(
            otherId
          ).style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;
        });
      }

      msg.innerHTML =
        otherWindows.size === 0
          ? "未发现其他窗口"
          : `发现窗口: <ol>${[...otherWindows.keys()]
              .map((it) => `<li>${it}</li>`)
              .join("")}</ol>`;
      render();
    });
  }

  render();
  // center.style.backgroundColor = color;
</script>
</html>